<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../at-core-theme/at-core-theme.html">
<link rel="import" href="../at-core-splitter/at-core-splitter.html">
<link rel="import" href="../at-core-propform/at-core-propform.html">

<dom-module id="at-doc-demo">
  <style>
    .container {
      margin: 5% 10%;
    }

    #insertPoint {
      margin: 0 13px;
    }

    .content-wrapper {
      width: 50%;
    }
  </style>
  <template>
    <div class="container horizontal layout">
      <div class="flex">
        <at-core-propform id="coreForm"></at-core-propform>
      </div>
      <at-core-splitter id="atSplitter" direction="right"></at-core-splitter>
      <div class="vertical layout content-wrapper">
        <div id="insertPoint"></div>
      </div>
    </div>
  </template>
  <script>
    'use strict';
    Polymer({
      is: 'at-doc-demo',
      properties: {
        url: {
          type: String,
          value: '',
          observer: 'urlChanged'
        },
        auto: {
          type: Boolean,
          value: false
        }
      },
      _scopeCssViaAttr: true,
      attached: function () {
        var bodyHeight = document.body.getBoundingClientRect().height;
        var atSplitter = this.$.atSplitter;
        atSplitter.style['min-height'] = (bodyHeight-300) + 'px';
      },
      ready: function() {

        if (this.auto && this.url === '') {
          // autogenerate the url
          var url = window.location.href;
          var urlParts = url.split("/");
          if (urlParts.length > 2) {
            var componentName = urlParts[urlParts.length - 2];
            var newUrl = componentName + '.html';
            this.url = newUrl;
          }
        }
      },
      resetResizeSensor: function() {
        var coreForm = this.$.coreForm;
        coreForm.resetResizeSensor();
      },
      urlChanged: function(newValue, oldValue) {
        var insertPoint = this.$.insertPoint;
        var coreForm = this.$.coreForm;
        if (newValue !== '') {
          this.importHref(this.url, function(event) {
            // import successful
            var importedContent = event.target.import;
            var domModule = importedContent.querySelector('dom-module');
            var elementName = domModule.getAttribute('id');
            var element = document.createElement(elementName);
            Polymer.dom(insertPoint).appendChild(element);

            coreForm.elementInstance = element;

          }, function(event) {
            // failure
          });
        }
      }
    });
  </script>
</dom-module>
